{% extends "base.html" %}

{% block head %}
<title>{{data.pref_name_jp}} 機種から探すTOP</title>
{% endblock %}

{% block content %}
<div class="container">
    <div class='row justify-content-center'>
        <div class='col-lg-8 text-center'>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="/">HOME</a></li>
                  <li class="breadcrumb-item active" aria-current="page"><a href="/tomorrow_recommend/machine/select-page">機種から探す</a></li>
                </ol>
            </nav>
            <h1>機種から探すTOP</h1>
            {% if data.error_message != '' %}
              <div class="p-3 mb-2 bg-danger text-white">{{data.error_message|safe }}</div>
            {% endif %}
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-lg-8 text-center">
            <div class="progressbar mt-3 mb-1 py-2">
                <div class="item active">STEP.1<br>打ちたい機種と地域を選択</div>
                <div class="item">STEP.2<br>行きたい日付を選択</div>
                <div class="item">STEP.3<br>詳細を選択</div>
            </div>
            <div class="japan_map">
              <img src="../static/img/japanmap.png" alt="日本地図">
              <span class="area_btn area1" data-area="1">北海道・東北</span>
              <span class="area_btn area2" data-area="2">関東</span>
              <span class="area_btn area3" data-area="3">中部</span>
              <span class="area_btn area4" data-area="4">近畿</span>
              <span class="area_btn area5" data-area="5">中国・四国</span>
              <span class="area_btn area6" data-area="6">九州・沖縄</span>
              
              <div class="area_overlay"></div>
              <div class="pref_area">
                  <div class="pref_list" data-list="1">
                      <div data-id="1">北海道</div>
                      <div data-id="2">青森県</div>
                      <div data-id="3">岩手県</div>
                      <div data-id="4">宮城県</div>
                      <div data-id="5">秋田県</div>
                      <div data-id="6">山形県</div>
                      <div data-id="7">福島県</div>
                      <div></div>
                  </div>
                  
                  <div class="pref_list" data-list="2">
                      <div data-id="8">茨城県</div>
                      <div data-id="9">栃木県</div>
                      <div data-id="10">群馬県</div>
                      <div data-id="11">埼玉県</div>
                      <div data-id="12">千葉県</div>
                      <div data-id="13">東京都</div>
                      <div data-id="14">神奈川県</div>
                      <div></div>
                  </div>
                  
                  <div class="pref_list" data-list="3">
                      <div data-id="15">新潟県</div>
                      <div data-id="16">富山県</div>
                      <div data-id="17">石川県</div>
                      <div data-id="18">福井県</div>
                      <div data-id="19">山梨県</div>
                      <div data-id="20">長野県</div>
                      <div data-id="21">岐阜県</div>
                      <div data-id="22">静岡県</div>
                      <div data-id="23">愛知県</div>
                      <div></div>
                  </div>
                  
                  <div class="pref_list" data-list="4">
                      <div data-id="24">三重県</div>
                      <div data-id="25">滋賀県</div>
                      <div data-id="26">京都府</div>
                      <div data-id="27">大阪府</div>
                      <div data-id="28">兵庫県</div>
                      <div data-id="29">奈良県</div>
                      <div data-id="30">和歌山県</div>
                      <div></div>
                  </div>
                  
                  <div class="pref_list" data-list="5">
                      <div data-id="31">鳥取県</div>
                      <div data-id="32">島根県</div>
                      <div data-id="33">岡山県</div>
                      <div data-id="34">広島県</div>
                      <div data-id="35">山口県</div>
                      <div data-id="36">徳島県</div>
                      <div data-id="37">香川県</div>
                      <div data-id="38">愛媛県</div>
                      <div data-id="39">高知県</div>
                      <div></div>
                  </div>
                  
                  <div class="pref_list" data-list="6">
                      <div data-id="40">福岡県</div>
                      <div data-id="41">佐賀県</div>
                      <div data-id="42">長崎県</div>
                      <div data-id="43">熊本県</div>
                      <div data-id="44">大分県</div>
                      <div data-id="45">宮崎県</div>
                      <div data-id="46">鹿児島県</div>
                      <div data-id="47">沖縄県</div>
                  </div>
              </div>
          </div>
          <select name="pref_id" class="form-select form-select-lg mb-2" 　aria-label="prefecture select" >
              <option selected>都道府県を選択</option>
              {% for pref_id,prefecture_name in data.prefecture_id_and_name_dict.items() %}
                  <option  value="{{ pref_id }}">{{ prefecture_name }}</option>
              {% endfor %}
          </select>
            <p class="text-01 pt-3" id="target_machine_image_text"></p>
            <img id="target_machine_image" alt="" width="70%" style="max-width:400px;"/>
            <div class="row justify-content-center mt-2">
              <div class="col-lg-8 text-center">
                  <ul class="slider">
                      <div><img src="/static/img/content_image/257.jpg" onclick="click_machine_image(257)" ></div>
                      <div><img src="/static/img/content_image/191.jpg" onclick="click_machine_image(191)" ></div>
                      <div><img src="/static/img/content_image/94.jpg" onclick="click_machine_image(94)" ></div>
                      <div><img src="/static/img/content_image/43.jpg" onclick="click_machine_image(43)" ></div>
                      <div><img src="/static/img/content_image/1.jpg" onclick="click_machine_image(1)" ></div>
                      <div><img src="/static/img/content_image/253.jpg" onclick="click_machine_image(253)" ></div>
                      <div><img src="/static/img/content_image/231.jpg" onclick="click_machine_image(231)" ></div>
                      <div><img src="/static/img/content_image/221.jpg" onclick="click_machine_image(221)" ></div>
                      <div><img src="/static/img/content_image/201.jpg" onclick="click_machine_image(201)" ></div>
                      <div><img src="/static/img/content_image/136.jpg" onclick="click_machine_image(136)" ></div>
                    </ul>
                  <div class="dots-2"></div>
                  <div class = '.table-wrap table-half'>
                      <table id="machine_table" class="table table-striped">
                          <thead>
                              <tr>
                                  {% for col in data.groupby_machine_name_count_df_column_names %}
                                  <th>
                                  {{ col | safe }}
                                  </th>
                                  {% endfor %}
                              </tr>
                          </thead>
                          <tbody>
                              {% for row in data.groupby_machine_name_count_df_row_data %}
                              <tr>
                                  {% for col, row_ in zip(data.groupby_machine_name_count_df_column_names, row) %}
                                      {% if col == '機種画像' %}
                                          <td><img class="table_image" src="/static/img/content_image/{{ row_.split("_")[0]  }}.jpg" onclick="click_machine_image({{ row_.split("_")[0]  }})" alt="{{ row_.split('_')[1] }}" /></td>
                                      {% else %}
                                          <td><a href="javascript:void(0);" onclick="click_machine_image({{ row_.split("_")[0]  }})" >{{ row_.split("_")[1] }}</a></td>
                                      {% endif %}
                                  {% endfor %}
                              </tr>
                              {% endfor %}
                          </tbody>
                      </table>
                  </div>
              </div>
            </div>
            <div class="progressbar mt-3 mb-1 py-2">
                <div class="item">STEP.1<br>打ちたい機種を選択</div>
                <div class="item active">STEP.2<br>行きたい日付を選択</div>
                <div class="item">STEP.3<br>詳細を選択</div>
            </div>
            <form method="post" action="/result_machine_search">
                <fieldset class="radio-003">
                    {% for i , (p_text,name) in enumerate(data.date_dict.items()) %}
                        <label>
                            {% if i == 1 %}
                            <input type="radio" name="target_day" value={{name}} checked/>
                            {% else %}
                            <input type="radio" name="target_day" value={{name}} />
                            {% endif %}
                            {{ p_text }}
                        </label>
                    {% endfor %}
                </fieldset>
            <div class="progressbar mt-3 mb-1 py-2">
                <div class="item">STEP.1<br>打ちたい機種を選択</div>
                <div class="item">STEP.2<br>行きたい日付を選択</div>
                <div class="item active ">STEP.3<br>詳細を選択</div>
            </div>

            <div class="d-grid gap-2 col-10 mx-auto">
              <!--8.レンジスライダーの設定-->
              <button class="btn btn-outline-primary btn-sm" type="button">最低設置台数:</button>
              <details class="qa-001 my-2">
                <summary>最低設置台数とは？</summary>
                <p>最低設置台数を選べます。台数が多い機種は最低5台以上などがお勧めです。</p>
              </details>
              <div class="spinner-container">
                  <span class="spinner-sub disabled">
                  <p class="spinner-p">-</p>
                  </span>
                  <input class="spinner" name="target_machine_number" id="spinner_number" type="number" min="1" max="30" value="3" onclick="change_spinner_number()">
                  <span class="spinner-add">
                  <p class="spinner-p1">+</p>
                  </span>
              </div>
              <button class="btn btn-outline-primary btn-sm mt-3" type="button">日別最低平均差枚:</button>
              <details class="qa-001 my-2">
                <summary>日別最低平均差枚とは？</summary>
                <p>店舗別日別の最低平均抽出差枚を選べます。<br>デフォルトは日別で高配分目安の-100枚以上ですが過疎地域や等価地域などでうまく出ない場合は抽出平均差枚をもう少し下げてから再検索をお勧めします。<br>2000枚以上等で検索すると前回のNの日の全台系なども探せます。</p>
              </details>
              <div class="spinner-container">
                  <span class="spinner-ave-diffcoins-sub disabled">
                  <p class="spinner-p">-</p>
                  </span>
                  <input class="spinner-ave" name="spinner_ave_diffcoins_number" id="spinner_ave_diffcoins_number" type="number" min="-500" max="2000" value="-100" onclick="change_spinner_ave_diff_conis()">
                  <span class="spinner-ave-diffcoins-add">
                  <p class="spinner-p1">+</p>
                  </span>
              </div>
            </div>
            <!-- formメソッドを使って検索するボタンを設置 -->
                <input type="hidden" name="pref_name_en" value="tokyo">
                <input type="hidden" name="pref_name" value="{{data.pref_name_jp}}">
                <input type="hidden" id="target_machine_input_id" name="target_machine_id" value="">
                <button class="btn btn-primary btn-lg my-3" id="search_btn">この条件で検索する</button>
            </form>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1/i18n/jquery.ui.datepicker-ja.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/cupertino/jquery-ui.min.css">  <!-- テーマcupertinoを選択 -->
<script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

<script>
    // 画像をクリックすると下に選択された機種画像が表示される関数
    function click_machine_image(img_num){
        console.log('click_machine_image');
        console.log(img_num);
        var img = document.getElementById('target_machine_image');
        var img_text = document.getElementById('target_machine_image_text');
        var image_input = document.getElementById('target_machine_input_id');
        img_text.innerHTML = '選択した機種';
        img.src = "/static/img/content_image/" + img_num + ".jpg";
        image_input.value = img_num;
        //document.getElementById('myImage').src='pic_bulbon.gif'
    };
    

  
    $(function () {
      $('.spinner').each(function change_spinner_number() {
        var el  = $(this);
        var add = $('.spinner-add');
        var sub = $('.spinner-sub');
        var spinner_number = document.getElementById('spinner_number');
    
        // substract
        el.parent().on('click', '.spinner-sub', function() {
          if (el.val() > parseInt(el.attr('min'))) {
            el.val(function(i, oldval) {
              spinner_number.value = parseInt(oldval) - 1;
              //console.log(spinner_number.value);
              return --oldval;
            });
          }
          // disabled
          if (el.val() == parseInt(el.attr('min'))) {
            el.prev(sub).addClass('disabled');
          }
          if (el.val() < parseInt(el.attr('max'))) {
            el.next(add).removeClass('disabled');
          }
        });
    
        // increment
        el.parent().on('click', '.spinner-add', function() {
          if (el.val() < parseInt(el.attr('max'))) {
            el.val(function(i, oldval) {
              spinner_number.value = parseInt(oldval) + 1;
              //console.log(spinner_number.value);
              return ++oldval;
            });
          }
          // disabled
          if (el.val() > parseInt(el.attr('min'))) {
            el.prev(sub).removeClass('disabled');
          }
          if (el.val() == parseInt(el.attr('max'))) {
            el.next(add).addClass('disabled');
          }
        });
      });
    });

    $(function () {
      $('.spinner-ave').each(function change_spinner_ave_diff_conis() {
        var el  = $(this);
        var add = $('.spinner-ave-diffcoins-add');
        var sub = $('.spinner-ave-diffcoins-sub');
        var spinner_number = document.getElementById('spinner_ave_diffcoins_number');
    
        // substract
        el.parent().on('click', '.spinner-ave-diffcoins-sub', function() {
          if (el.val() > parseInt(el.attr('min'))) {
            el.val(function(i, oldval) {
              spinner_number.value = parseInt(oldval) - 100;
              //console.log(spinner_number.value);
              return parseInt(oldval) - 100 ;
            });
          }
          // disabled
          if (el.val() == parseInt(el.attr('min'))) {
            el.prev(sub).addClass('disabled');
          }
          if (el.val() < parseInt(el.attr('max'))) {
            el.next(add).removeClass('disabled');
          }
        });
    
        // increment
        el.parent().on('click', '.spinner-ave-diffcoins-add', function() {
          if (el.val() < parseInt(el.attr('max'))) {
            el.val(function(i, oldval) {
              spinner_number.value = parseInt(oldval) + 100;
              //console.log(spinner_number.value);
              return parseInt(oldval) + 100;
            });
          }
          // disabled
          if (el.val() > parseInt(el.attr('min'))) {
            el.prev(sub).removeClass('disabled');
          }
          if (el.val() == parseInt(el.attr('max'))) {
            el.next(add).addClass('disabled');
          }
        });
      });
    });
</script>
{% endblock %}


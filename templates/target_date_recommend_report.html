{% extends "base.html" %}

{% block head %}
<title>ãƒ‡ãƒ¼ã‚¿ã®å‡ºåŠ›</title>
{% endblock %}



{% block content %}
<div class ='container'>
    <div class="row">
      <div class="col-12">
        <h1>{{data['target_number']}}ã®ã¤ãæ—¥ã®ç›´è¿‘{{serch_number}}å›åˆ† åˆ†æçµæœ</h1>
        <div>
          <h2>è¡ŒããŸã„æ—¥ä»˜ï¼š {{ user_data['recommend-day'] }}</h2>
            <br><h2>æ¯”è¼ƒã—ãŸæ—¥ä»˜</h2>
          <p>æ¯”è¼ƒã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯{{ user_data['tenpo-name'] }}ã®</p>
            {% for date in target_day_list_jp %}
              <ul class = 'day_list '>{{ date }}</ul>
            {% endfor %}
          <p>ã€€ã®{{data['target_number']}}ã®ã¤ãæ—¥ã®ç›´è¿‘{{serch_number}}å›åˆ†ãƒ‡ãƒ¼ã‚¿ã‚’ä»Šå›é›†è¨ˆã—ã¾ã—ãŸã€‚</p>
        </div>
      </div>
    </div>

    <div class="col-12">
      <canvas id="canvas"></canvas>
    </div>

    <div class="col-12">
      <div class="scroll_area" style="width:100%;max-width:700px;overflow-x:scroll;">
        <table style="width:100%;">
          {{samai_table|safe}}
        </table>
      </div>
    </div>
  </div>
</div>

<script>

window.onload = function() {
  ctx = document.getElementById("canvas").getContext("2d");
    window.myBar = new Chart(ctx, {
        type: 'bar',
        data: barChartData,
        options: complexChartOption
    });
  };
  var complexChartOption = {
  responsive: true,
  scales: {
      yAxes: [{
          id: "y-axis-1",
          type: "linear", 
          position: "left",
          ticks: {
              max: 0.2,
              min: 0,
              stepSize: 0.1
          },
      }, {
          id: "y-axis-2",
          type: "linear", 
          position: "right",
          ticks: {
              max: 1.5,
              min: 0,
              stepSize: .5
          },
          gridLines: {
              drawOnChartArea: false, 
          },
      }],
  }
};
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.min.js"></script>


  

<script>
var barChartData = {
    labels: {{ target_day_list_jp|safe }},
    datasets: [
    {
        type: 'line',
        label: 'å¹³å‡å·®æš',
        data: {{ samai_list|safe }},
        borderColor : "rgba(254,97,132,0.8)",
                pointBackgroundColor    : "rgba(254,97,132,0.8)",
                fill: false,
        yAxisID: "y-axis-1",// è¿½åŠ 
        borderWidth: 5,
        pointHoverRadius: 8,
        pointBackgroundColor: "rgba(254,97,132,0.8)",

    },
    {
        type: 'bar',
        label: 'å¹³å‡Gæ•°',
        data: {{ gamesuu_list| safe}},
        borderColor : "rgba(54,164,235,0.8)",
        backgroundColor : "rgba(54,164,235,0.5)",
        yAxisID: "y-axis-2",
    },],
};
</script>

<script>
var complexChartOption = {
    responsive: true,
    scales: {
      
        yAxes: [{
            id: "y-axis-1",
            type: "linear", 
            position: "left",
            ticks: {
                max: 700,
                min: -300,
                stepSize: 100,
                fontSize: 10,
                callback: function(value, index, values) {
                  return 'å¹³å‡' + value + 'æš';}
            },
        }, {
            id: "y-axis-2",
            type: "linear", 
            position: "right",
            ticks: {
                max: 6000,
                min: 1000,
                stepSize: 1000,
                fontSize: 10,
                callback: function(value, index, values) {
                  return  value + 'G';}
            },
            gridLines: {
                drawOnChartArea: false, 
                borderWidth: 3,
            },
        }],
    }

};
element.style.width = '400px';
element.style.height = '600px';
</script>



<h1><p>{{ user_data['tenpo-name'] }}  {{data['target_number']}}ã®ã¤ãæ—¥<br>ç›´è¿‘éå»{{serch_number}}å›åˆè¨ˆåˆ†ã§æœ€ã‚‚å‡ºã¦ã„ãŸãŠå‹§ã‚æ©Ÿç¨®TOP10</p></h1>
<h2>â€»ãƒãƒ©ã‚¨ãƒ†ã‚£æ©Ÿç¨®ã¯é™¤ã</h2>
<h2>â€»åˆè¨ˆ{{serch_number}}å›åˆ†ã®åˆè¨ˆãƒ‡ãƒ¼ã‚¿ã§ã™</h2>
<div class='design16 .table-wrap'>
  <div class="scroll_area" style="width:100%;max-width:1000px;overflow-x:scroll;">
    <table style="width:100%;">
  {{groupby_kisyu_table|safe}}
    </table>
  </div>
</div>

<script>
  
  $(function(){
    // ãƒãƒ–ãƒ«ãƒãƒ£ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿
    var bubleChartData = {
        datasets: [
        {% for index, row in output_bubble_chart_df.iterrows() %}
            {
              data: [{"x":{{ row['å¹³å‡Gæ•°']  }} ,"y":{{ row['å¹³å‡å·®æš'] }}, "r":{{ row['åˆè¨ˆå·®æš'] /750}}} ,],
              // è‰²ï¼ˆ2å€‹ç›®ï¼‰
              {% autoescape false %}
                backgroundColor:["{{ row['color'] }}"],
              {% endautoescape %}
              // ãƒ©ãƒ™ãƒ«ï¼ˆ2å€‹ç›®ï¼‰
              {% autoescape false %}
                label: ["{{ row['æ©Ÿç¨®å'] }}"]  
              {% endautoescape %}
            },
        {% endfor %}
        ]};

    // ã‚ªãƒ—ã‚·ãƒ§ãƒ³
    var bubble_chart_options = {
          layout: {
            font: {
                size: 30,
                weight: 'bold'
            },
            padding: {
                left: 0,
                right: 0,
                top: 0,
                bottom: 0
              }
            },
          responsive: true,
          maintainAspectRatio: true,
          legend: {             // å‡¡ä¾‹ã®è¨­å®š
            position: "bottom",     // è¡¨ç¤ºä½ç½®
            labels: {              // å‡¡ä¾‹æ–‡å­—åˆ—ã®è¨­å®š
                fontSize: 22,
            }
          },
          // ã‚¿ã‚¤ãƒˆãƒ«

          tooltips: {
            callbacks: {
               label: function(t, d) {
                  var rLabel = d.datasets[t.datasetIndex].data[t.index].r;
                  return d.datasets[t.datasetIndex].label + 
                         ': (å¹³å‡:' + t.xLabel + 'G å¹³å‡å·®æš:' + t.yLabel + 'æš ç·å·®æš:' + rLabel.toFixed(1) + 'ä¸‡æš';
               }
            }
          },
              // å¹³å‡Gæ•°
          scales: {
              x: {
                  ticks: {
                    padding:10,    // å€‹åˆ¥è¨­å®šä¸å¯
                    stepSize: 1000,
                    font: {
                      size: 30,
                    },
                    showLabelBackdrop: true,
                    backdropPadding: { x: 1, y: 2 },
                    major: {
                      enabled: true,
                    },
                    align: 'center',
                    crossAlign: 'center',
                    sampleSize: 24,
                    callback: function(label, index, labels) {
                      return label + 'G';
                  }
                  },
                  title: {
                    display: true,
                    text: 'å¹³å‡Gæ•°',
                    padding: {
                      top: 0,    // å³å´
                      bottom: 0  // å·¦å´
                    },
                    font: {
                      size: 14,
                      weight: 'bold'
                    },
                    color: '#000'},
 
              },
              y: {
                title: {
                  display: true,
                  text: 'å¹³å‡å·®æš',
                  padding: {
                    top: 0,    // å³å´
                    bottom: 0  // å·¦å´
                  },
                  font: {
                    size: 14,
                    weight: 'bold'
                  },
                  color: '#000'},
                // æœ€å°å€¤ãƒ»æœ€å¤§å€¤
                // ç›®ç››ãƒ©ãƒ™ãƒ«
                ticks: {
                  padding: 15,    // å€‹åˆ¥è¨­å®šä¸å¯
                  stepSize: 1000,
                  font: {
                    size: 24,
                    weight: 'bold'
                  },
                  showLabelBackdrop: true,
                  backdropPadding: { x: 4, y: 2 },
                  major: {
                    enabled: true,
                  },
                  align: 'center',
                  crossAlign: 'center',
                  sampleSize: 24,
                  callback: function(label, index, labels) {
                    return label + 'æš';
                  }
                },

              },
          },
    };

    // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    
    var ctx = $("#bubblechart")[0].getContext("2d");
    // ãƒãƒ–ãƒ«ãƒãƒ£ãƒ¼ãƒˆã®æç”»
    var bubbleChart = new Chart(ctx, 
            {
               type: 'bubble',
               data: bubleChartData,
               options: bubble_chart_options
            });
  });
  Chart.defaults.global.defaultFontFamily = "sans-serif";
  Chart.defaults.global.defaultFontSize = 28;

  </script>
 
<h1>ãŠå‹§ã‚æ©Ÿç¨®ç·å·®æšãƒãƒ–ãƒ«ãƒãƒ£ãƒ¼ãƒˆ</h1>
<h2>ã“ã®ã‚°ãƒ©ãƒ•ã§ã©ã®æ©Ÿç¨®ã«å‡ºç‰ã®é…åˆ†ãŒã‚ã‚‹ã‹ãŒã™ãåˆ†ã‹ã‚Šã¾ã™</h2>
<canvas id="bubblechart"></canvas>



<h1>æ—¥åˆ¥æ©Ÿç¨®åˆ¥å·®æšé †éå»{{serch_number}}å›åˆè¨ˆãƒ‡ãƒ¼ã‚¿TOP30</h1>
<h2>å…¨å°ç³»ã¯ã“ã“ã‹ã‚‰è¦‹ã‚‹ã¨ğŸ‘</h2>
<div class="scroll_area" style="width:100%;max-width:1000px;overflow-x:scroll;">
  <table class='design17' style="width:100%;">
      <thead>
        <tr>
          {% for col in column_names %}
          <th>
            {{col}}
          </th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in row_data %}
        <tr>
          {% for col, row_ in zip(column_names, row) %}
          <td>{{row_}}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
  </table>
  </div>
</div>
<h1>æ—¥åˆ¥æ©Ÿç¨®åˆ¥å·®æšé †ãƒ‡ãƒ¼ã‚¿TOP30</h1>
<h2>æ—¥æ¯ã®ãƒ‡ãƒ¼ã‚¿ã¯ã“ã“ã§ãƒã‚§ãƒƒã‚¯</h2>
{% for day_df , date in zip(display_day_df_list,target_day_list_jp) %}
  <ul class = 'day_list '>{{ date }}</ul>
  <div class='design16 .table-wrap'>
    <div class="scroll_area" style="width:100%;max-width:1000px;overflow-x:scroll;">
      <table style="width:100%;">
        {{day_df|safe}}
      </table>
    </div>
  </div>
{% endfor %}



{% endblock %}